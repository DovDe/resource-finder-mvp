"use strict";angular.module("resourceFinderMvpApp",["ui.router","ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ngMap","firebase"]).config(["$urlRouterProvider","$stateProvider",function(e,r){e.otherwise("/main"),r.state("user-profile",{url:"/user-profile",templateUrl:"views/user-profile.html",controller:"UserProfileCtrl"}).state("main",{url:"/main",views:{"":{templateUrl:"views/main.html",controller:"MainCtrl as vm"}}}).state("user-profile.register",{url:"/user-profile/register",templateUrl:"views/user-profile.register.html",controller:"UserProfileCtrl"}).state("user-profile.login",{url:"/user-profile/login",templateUrl:"views/user-profile.login.html",controller:"UserProfileCtrl"}).state("add-a-resource",{url:"/add-a-resource",templateUrl:"views/add-a-resource.html",controller:"AddAResourceCtrl",resolve:{currentAuth:["authentication",function(e){return e.requireAuth()}]}})}]),angular.module("resourceFinderMvpApp").controller("MainCtrl",["NgMap","$scope","$state","$rootScope","$timeout","$firebase","$firebaseAuth","$firebaseArray","authentication",function(e,r,t,o,s,n,a,i,u){var c=this,l=(a(),firebase.database().ref()),g=l.child("resource"),d=i(g);c.resourceMarkers=d,o.address=c.address,o.resource=d,c.addingResource=!1,c.hideinput=!1,c.inProgress=!1,c.trueMarkerTypes=[],c.markerFilters=!1,o.homeIcon="/images/home.png",o.userProfileIcon="/images/user-profile.png",o.settingsIcon="/images/settings.png";var m=new google.maps.Geocoder,f=function(e){var r=document.getElementById("latlng").value,t=r.split(",",2),s={lat:parseFloat(t[0]),lng:parseFloat(t[1])};e.geocode({location:s},function(e,r){"OK"===r?e[1]?(o.NewResourceAddress=e[1].formatted_address,console.log(o.NewResourceAddress)):window.alert("No results found"):window.alert("Geocoder failed due to: "+r)})};e.getMap().then(function(e){c.map=e,c.home=c.map.getCenter(),o.currentMarkerLat=c.home.lat(),o.currentMarkerLng=c.home.lng();var r=o.currentMarkerLat.toString()+","+o.currentMarkerLng.toString();c.currentMarkerValue=r}),c.placeChanged=function(){c.place=this.getPlace(),c.map.setCenter(c.place.geometry.location)},c.placeMarker=function(e){if(!c.inProgress){c.map.panTo(e.latLng),c.home=c.map.getCenter(),o.currentMarkerLat=c.home.lat(),o.currentMarkerLng=c.home.lng();var r=o.currentMarkerLat+","+o.currentMarkerLng;c.currentMarkerValue=r,c.showCustomMarker=function(){c.map.customMarkers.customthings.setVisible(!0),c.map.customMarkers.customthings.setPosition(c.home)},c.showCustomMarker(),c.inProgress=!0,s(function(){f(m)},300)}},c.closeCustomMarker=function(){c.map.customMarkers.customthings.setVisible(!1)},c.reAble=function(){s(function(){c.inProgress=!1},1e3)},c.showMarkerData=function(e,r){c.resource=r,c.map.showInfoWindow("markerdata",r.id)},c.showMarkerFilters=function(){c.markerFilters===!1?c.markerFilters=!0:c.markerFilters=!1},c.logout=function(){u.logout()}}]),angular.module("resourceFinderMvpApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("resourceFinderMvpApp").factory("addAResource",function(){var e=42;return{someMethod:function(){return e}}}),angular.module("resourceFinderMvpApp").controller("AddAResourceCtrl",["$firebase","$firebaseAuth","$firebaseArray","$firebaseObject","$scope","$rootScope","$state","$timeout",function(e,r,t,o,s,n,a,i){var u=firebase.database().ref(),c=r();s.resourceaddress=n.NewResourceAddress,s.resourcelat=n.currentMarkerLat,s.resourcelng=n.currentMarkerLng;var l=u.child("resource"),g=t(l);n.resource=g,c.$onAuthStateChanged(function(e){e&&(s.resource.name="",s.resource.hours="",s.resource.description="",s.resource.website="",s.resource.state="",s.resource.city="",s.resource.phone="",s.addResource=function(e){g.$add({name:s.resource.name,date:firebase.database.ServerValue.TIMESTAMP,type:s.resource.type,hours:s.resource.hours,description:s.resource.description,location:{LatLng:{lat:s.currentMarkerLat,lng:s.currentMarkerLng},formatted_address:n.NewResourceAddress,state:s.resource.state,city:s.resource.city},website:s.resource.website,phone:s.resource.phone}),s.resource.name="",s.resource.type={shelter:!1,water:!1,food:!1,electricity:!1,clothing:!1,sanitation:!1},s.resource.website="",s.resource.hours="",s.resource.description="",s.resource.formatted_address="",s.resource.location.state="",s.resource.location.city="",s.resource.location.state="",s.resource.phone="",s.message="Thank for adding a resource",i(function(){a.go("main")},1e3)},s.deleteResource=function(e){g.$remove(e)})})}]),angular.module("resourceFinderMvpApp").factory("userProfile",function(){var e=42;return{someMethod:function(){return e}}}),angular.module("resourceFinderMvpApp").controller("UserProfileCtrl",["$scope","authentication","$rootScope",function(e,r,t){t.homeIcon="/images/home.png",t.userProfileIcon="/images/user-profile.png",t.settingsIcon="/images/settings.png",e.login=function(){r.login(e.user)},e.logout=function(){r.logout()},e.register=function(){r.register(e.user)}}]),angular.module("resourceFinderMvpApp").factory("authentication",["$rootScope","$location","$firebaseAuth","$firebaseObject",function(e,r,t,o){var s,n=firebase.database().ref(),a=t();return a.$onAuthStateChanged(function(r){if(r){var t=n.child("users").child(r.uid),s=o(t);e.currentUser=s}else e.currentUser=""}),s={login:function(t){a.$signInWithEmailAndPassword(t.email,t.password).then(function(e){r.path("/main")})["catch"](function(r){e.message=r.message})},logout:function(){return a.$signOut()},requireAuth:function(){return a.$requireSignIn()},register:function(r){a.$createUserWithEmailAndPassword(r.register.email,r.register.password).then(function(t){n.child("users").child(t.uid).set({date:firebase.database.ServerValue.TIMESTAMP,regUser:t.uid,firstname:r.register.firstname,lastname:r.register.lastname,email:r.register.email,password:r.register.password});e.message="Hi"+r.firstname+",Thanks for registering",s.login(r)})["catch"](function(r){e.message=r.message})}}}]);